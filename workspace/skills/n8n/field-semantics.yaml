# Semantic field rules for n8n platform events.
#
# This file is read by the deterministic generateMapping pipeline —
# NOT by the conversational agent. It defines which fields are identifiers,
# which are dimensions, which are measures, and how they relate.
#
# Schema validated by: mastra/lib/semantics/fieldSemantics.ts (Zod)
# Consumed by: mastra/tools/generateMapping.ts → applySemanticOverrides()

version: 1
entity_type: workflow_run
platform: n8n

field_rules:
  workflow_id:
    semantic_type: identifier
    references: workflow_name
    chart_eligible: false
    aggregation: count
    role: hero
    display_name: Total Workflows
    reason: "Foreign key to workflow — use workflow_name for display labels"

  workflow_name:
    semantic_type: dimension
    chart_eligible: true
    component_preference: PieChart
    max_pie_cardinality: 6
    aggregation: count_per_category
    role: breakdown
    display_name: Workflow
    reason: "Human-readable workflow label — primary breakdown dimension"

  execution_id:
    semantic_type: surrogate_key
    chart_eligible: false
    aggregation: count
    role: hero
    display_name: Total Runs
    reason: "Surrogate key — count only, never chart as category"

  status:
    semantic_type: dimension
    chart_eligible: true
    component_preference: MetricCard
    aggregation: percentage
    role: hero
    display_name: Success Rate
    reason: "Binary status dimension — best as percentage metric"

  duration_ms:
    semantic_type: measure
    chart_eligible: false
    aggregation: avg
    unit: ms
    role: supporting
    display_name: Avg Duration
    reason: "Numeric measure — average is most meaningful"

  started_at:
    semantic_type: time_dimension
    chart_eligible: true
    component_preference: TimeseriesChart
    aggregation: count_per_interval
    role: trend
    display_name: Started
    reason: "Primary time axis for trend charts"

  ended_at:
    semantic_type: time_dimension
    chart_eligible: false
    aggregation: none
    role: detail
    display_name: Ended
    reason: "Secondary time field — detail only, not trend axis"

  platform:
    semantic_type: constant
    chart_eligible: false
    aggregation: none
    role: detail
    display_name: Platform
    reason: "Constant value in single-platform context — no information content"

  error_message:
    semantic_type: detail
    chart_eligible: false
    aggregation: none
    role: detail
    display_name: Error
    reason: "Free-text error detail — table column only"

  call_id:
    semantic_type: surrogate_key
    chart_eligible: false
    aggregation: count
    role: hero
    display_name: Total Calls
    reason: "Surrogate key for voice platforms — count only"

  session_id:
    semantic_type: surrogate_key
    chart_eligible: false
    aggregation: count
    role: hero
    display_name: Total Sessions
    reason: "Surrogate key — count only"

  conversation_id:
    semantic_type: surrogate_key
    chart_eligible: false
    aggregation: count
    role: hero
    display_name: Total Conversations
    reason: "Surrogate key — count only"

  scenario_id:
    semantic_type: identifier
    references: scenario_name
    chart_eligible: false
    aggregation: count
    role: hero
    display_name: Total Scenarios
    reason: "Make.com identifier — use scenario_name for display"

  scenario_name:
    semantic_type: dimension
    chart_eligible: true
    component_preference: PieChart
    max_pie_cardinality: 6
    aggregation: count_per_category
    role: breakdown
    display_name: Scenario
    reason: "Human-readable Make.com scenario label"

  flow_id:
    semantic_type: identifier
    references: workflow_name
    chart_eligible: false
    aggregation: count
    role: hero
    display_name: Total Flows
    reason: "Generic flow identifier — use workflow_name for display"

  agent_id:
    semantic_type: identifier
    references: agent_name
    chart_eligible: false
    aggregation: count
    role: hero
    display_name: Total Agents
    reason: "Agent identifier — use agent_name for display"

  agent_name:
    semantic_type: dimension
    chart_eligible: true
    component_preference: PieChart
    max_pie_cardinality: 6
    aggregation: count_per_category
    role: breakdown
    display_name: Agent
    reason: "Human-readable agent label"
